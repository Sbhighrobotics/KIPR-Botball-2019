#include <kipr/botball.h>
int speed = 2000;
int leftMotor = 1;
int rightMotor = 0;
int highGrey= 2700;
int lowBlack = 3700;

void follow();
void goTillBlack();
void followCamera();
void goForward(int time);



int main()
{
    shut_down_in(60);
    camera_open();
    
    //goForward(5000);
    //goForward(150);
    //goTillBlack();
    
    goForward(2000); 
  
    goTillBlack();
      mav(rightMotor,speed);
    mav(leftMotor,0);
    msleep(1200);
    follow();
 	followCamera();
    
    //mav(rightMotor,speed);
    //mav(leftMotor,0);
    /*follow();
    printf("\ndone1\n");
    printf("done2");
    */
    return 0;
}




void goForward(int t)
{
    mav(leftMotor, speed);
    mav(rightMotor, (speed));
    msleep(t);
}


void goTillBlack()
{
    while(analog(0)<lowBlack)
    {
    }
    mav(rightMotor,0);
    mav(leftMotor,0);
}



void follow()
{
	//double startTime = seconds();
    //printf("%f\n", startTime);
    int r = 0;
    while(r < 6)
    {

        if(analog(0)<=highGrey)
        {
            mav(rightMotor,speed/2);
            mav(leftMotor,speed);
            msleep(2);

            //printf("on grey");
        }else if(analog(0)>=lowBlack)
        {
            mav(leftMotor,speed/2);
            mav(rightMotor,speed);
            msleep(2);

            //printf("on black");
        }else
        {
            mav(rightMotor,speed);
            mav(leftMotor,speed);
            msleep(100);
            //mav(rightMotor,0);
            //mav(leftMotor,0);
        }
        camera_update();
        
        if (get_object_count(0) != 0) 
        {
	        r = get_object_bbox_width(0,0);
            printf("%d\n", r);
        }
        
    
    }
    mav(rightMotor,0);
    mav(leftMotor,0);
   // printf("%f\n", seconds() - startTime);
}


void followCamera()
{
    int width = get_object_bbox_width(0,0);
    int x=0; 
    while(width<12)
    {
        camera_update();
        x= get_object_center_x(0,0);
        if(x<90)
        {
            mav(rightMotor, speed);
             mav(leftMotor, speed/4);
            msleep(100);
        }
        if(x>90)
        {
             mav(leftMotor, speed);
             mav(rightMotor, speed/4);
            msleep(100);
        }
    }
    /*
     //int c=1;
    //int r=-1;
    //int y = -1;
     
    while(c>0)
    {
        camera_update();
        r = get_object_bbox_width(1,0);
        y = get_object_bbox_width(0,0);
        printf("%d,%d\n", r,y);


    }
    */
}










